Index: Make-lang.in
===================================================================
RCS file: /cvs/gcc/gcc/gcc/cp/Make-lang.in,v
retrieving revision 1.77.2.3
diff -c -3 -p -r1.77.2.3 Make-lang.in
*** Make-lang.in	2001/05/12 20:32:52	1.77.2.3
--- Make-lang.in	2001/07/03 14:16:04
*************** CXX_OBJS = cp/call.o cp/decl.o cp/errfn.
*** 100,106 ****
   cp/class.o cp/decl2.o cp/error.o cp/lex.o cp/parse.o cp/ptree.o cp/rtti.o \
   cp/spew.o cp/typeck.o cp/cvt.o cp/except.o cp/friend.o cp/init.o cp/method.o \
   cp/search.o cp/semantics.o cp/tree.o cp/xref.o cp/repo.o cp/dump.o \
!  cp/optimize.o cp/mangle.o
  
  # Use loose warnings for this front end.
  cp-warn =
--- 100,106 ----
   cp/class.o cp/decl2.o cp/error.o cp/lex.o cp/parse.o cp/ptree.o cp/rtti.o \
   cp/spew.o cp/typeck.o cp/cvt.o cp/except.o cp/friend.o cp/init.o cp/method.o \
   cp/search.o cp/semantics.o cp/tree.o cp/xref.o cp/repo.o cp/dump.o \
!  cp/optimize.o cp/mangle.o cp/xml.o
  
  # Use loose warnings for this front end.
  cp-warn =
*************** cp/dump.o: cp/dump.c $(CXX_TREE_H) c-dum
*** 275,280 ****
--- 275,281 ----
  cp/optimize.o: cp/optimize.c $(CXX_TREE_H) rtl.h integrate.h insn-config.h \
    input.h params.h
  cp/mangle.o: cp/mangle.c $(CXX_TREE_H) toplev.h
+ cp/xml.o: cp/xml.c $(CXX_TREE_H) toplev.h
  
  cp/parse.o: cp/parse.c $(CXX_TREE_H) flags.h cp/lex.h except.h output.h \
  	system.h toplev.h $(GGC_H)
Index: cp-tree.h
===================================================================
RCS file: /cvs/gcc/gcc/gcc/cp/cp-tree.h,v
retrieving revision 1.572.2.30
diff -c -3 -p -r1.572.2.30 cp-tree.h
*** cp-tree.h	2001/06/12 18:03:29	1.572.2.30
--- cp-tree.h	2001/07/03 14:16:10
*************** extern int flag_check_new;
*** 1142,1147 ****
--- 1142,1151 ----
  
  extern const char *flag_dump_class_layout;
  
+ /* Filename for xml dump of translation unit.  */
+ 
+ extern const char* flag_xml;
+ 
  
  /* C++ language-specific tree codes.  */
  #define DEFTREECODE(SYM, NAME, TYPE, LENGTH) SYM,
*************** extern tree mangle_guard_variable       
*** 4581,4586 ****
--- 4585,4593 ----
  
  /* in dump.c */
  extern int cp_dump_tree                         PARAMS ((dump_info_p, tree));
+ 
+ /* in xml.c */
+ extern void do_xml_output                       PARAMS((const char *));
  
  /* -- end of C++ */
  
Index: decl2.c
===================================================================
RCS file: /cvs/gcc/gcc/gcc/cp/decl2.c,v
retrieving revision 1.437.2.25
diff -c -3 -p -r1.437.2.25 decl2.c
*** decl2.c	2001/06/06 21:51:11	1.437.2.25
--- decl2.c	2001/07/03 14:16:20
*************** int flag_permissive;
*** 436,441 ****
--- 436,445 ----
  
  int flag_enforce_eh_specs = 1;
  
+ /* Filename for xml dump of translation unit.  */
+ 
+ const char* flag_xml = 0;
+ 
  /* The variant of the C language being processed.  */
  
  c_language_kind c_language = clk_cplusplus;
*************** cxx_decode_option (argc, argv)
*** 601,606 ****
--- 605,618 ----
  	  warning ("-fname-mangling-version is no longer supported");
  	  return 1;
  	}
+       else if ((option_value
+                 = skip_leading_substring (p, "xml=")))
+  	{
+         if (*option_value == '\0')
+           error ("no file specified with -fxml");
+         else
+           flag_xml = option_value;
+   	}
        else if (dump_switch_p (p))
  	;
        else 
Index: lang-options.h
===================================================================
RCS file: /cvs/gcc/gcc/gcc/cp/lang-options.h,v
retrieving revision 1.37.4.3
diff -c -3 -p -r1.37.4.3 lang-options.h
*** lang-options.h	2001/06/11 21:20:06	1.37.4.3
--- lang-options.h	2001/07/03 14:16:21
*************** DEFINE_LANG_NAME ("C++")
*** 117,122 ****
--- 117,125 ----
    { "-fweak", 
      N_("Emit common-like symbols as weak symbols") },
    { "-fno-weak", "" },
+   { "-fxml=",
+     N_("Enable XML output to a file (use with -fsyntax-only)") },
+   { "-fno-xml", "" },
    { "-fxref", 
      N_("Emit cross referencing information") },
    { "-fno-xref", "" },
Index: semantics.c
===================================================================
RCS file: /cvs/gcc/gcc/gcc/cp/semantics.c,v
retrieving revision 1.189.2.15
diff -c -3 -p -r1.189.2.15 semantics.c
*** semantics.c	2001/06/06 21:51:11	1.189.2.15
--- semantics.c	2001/07/03 14:16:24
*************** finish_translation_unit ()
*** 1663,1668 ****
--- 1663,1672 ----
    while (current_namespace != global_namespace)
      pop_namespace ();
    finish_file ();
+ 
+   /* Do XML output if output file was given.  */
+   if (flag_xml)
+       do_xml_output (flag_xml);
  }
  
  /* Finish a template type parameter, specified as AGGR IDENTIFIER.
